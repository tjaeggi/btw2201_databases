<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://tjaeggi.github.io/btw2201_databases/le12/ApacheCassandraTutorial/" rel="canonical"/>
<link href="../install-3nodecassandraCluster/" rel="prev"/>
<link href="../NoSQL_Aufgabe/" rel="next"/>
<link href="../../assets/LearningServicesLogo.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.49" name="generator"/>
<title>Tutorial - WING - btw2201-Databases</title>
<link href="../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Nunito:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Nunito";--md-code-font:"Roboto Mono"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<link href="https://unpkg.com/katex@0/dist/katex.min.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="deep-orange" data-md-color-primary="light-blue" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#eigenschaften-von-cassandra">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="WING - btw2201-Databases" class="md-header__button md-logo" data-md-component="logo" href="../.." title="WING - btw2201-Databases">
<img alt="logo" src="../../assets/LearningServicesLogo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            WING - btw2201-Databases
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Tutorial
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Dark mode" class="md-option" data-md-color-accent="deep-orange" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Light mode" class="md-option" data-md-color-accent="deep-orange" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="WING - btw2201-Databases" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="WING - btw2201-Databases">
<img alt="logo" src="../../assets/LearningServicesLogo.png"/>
</a>
    WING - btw2201-Databases
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    ABOUT THIS WEBSITE
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    LE01-CSVs mit Python
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            LE01-CSVs mit Python
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le01/ue01-1/">
<span class="md-ellipsis">
    UE01-1-Aufgaben
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le01/Loesungsvorschlaege_ue01-1/">
<span class="md-ellipsis">
    UE01-1-Lösungsvorschläge
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    LE02-SELECT Abfragen
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            LE02-SELECT Abfragen
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le02/UE02-1/">
<span class="md-ellipsis">
    UE02-Chinook-DB
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le02/Loesungsvorschlaege_UE02-1/">
<span class="md-ellipsis">
    UE02-1-Aufgaben I
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le02/UE02-2/">
<span class="md-ellipsis">
    UE02-2-Aufgaben II
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    LE03-Weiterführende SELECTs
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            LE03-Weiterführende SELECTs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le03/UE03-01-AB/">
<span class="md-ellipsis">
    UE03-1-AB-Ranking Table und View
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le03/UE03-2/">
<span class="md-ellipsis">
    UE03-2-Datum und Zeit
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le03/UE03-3/">
<span class="md-ellipsis">
    UE03-3-CSV in SQLite
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le03/UE03-4/">
<span class="md-ellipsis">
    UE03-4-SQL-Abfragen Strasserverz.
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    LE04-SQL und Python
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            LE04-SQL und Python
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/le04-einfpythonsqlite/">
<span class="md-ellipsis">
    Einführung Python mit SQLite
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/le04-einfbindings/">
<span class="md-ellipsis">
    Einführung Bindings
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/le04-einfcrud/">
<span class="md-ellipsis">
    Einführung CRUD
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/ue04-01/">
<span class="md-ellipsis">
    UE04-01
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/ue04-02/">
<span class="md-ellipsis">
    UE04-02
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/ue04-03/">
<span class="md-ellipsis">
    UE04-03
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le04/ue04-04/">
<span class="md-ellipsis">
    UE04-04
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le05/">
<span class="md-ellipsis">
    LE05-Docker-MySQL-Relationenmodell
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            LE05-Docker-MySQL-Relationenmodell
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le05/instMySQL/">
<span class="md-ellipsis">
    DOCKER-Installation MySQL-phpmyadmin
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le05/useful-docker-commands/">
<span class="md-ellipsis">
    Nützliche Docker-Befehle
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le05/ue05-01/">
<span class="md-ellipsis">
    UE05-01-MySQL und erste Datenbank
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le05/ue05-02/">
<span class="md-ellipsis">
    UE05-02-Datentransfer von SQLite-DB nach MySQL
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le05/ue05-03/">
<span class="md-ellipsis">
    UE05-03-Relationenmodell-PK-FK-ref.Integrität
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le06/">
<span class="md-ellipsis">
    LE06-Normalformen/ERM
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            LE06-Normalformen/ERM
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le06/ue06-01/">
<span class="md-ellipsis">
    UE06-01-Funktionale und Transitive Abhängigkeit - 3NF - SQL
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le06/ue06-02/">
<span class="md-ellipsis">
    UE06-02-Kardinalität-ERM
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le06/ue06-03/">
<span class="md-ellipsis">
    UE06-03-Schuldatenbank in MySQL
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le07/">
<span class="md-ellipsis">
    LE07-REPETITION
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            LE07-REPETITION
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le07/ue07-01/">
<span class="md-ellipsis">
    UE07-01-Übungen
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../lekn/">
<span class="md-ellipsis">
    Kompetenznachweis
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Kompetenznachweis
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le08/">
<span class="md-ellipsis">
    LE08-Table-JOINs
  </span>
</a>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            LE08-Table-JOINs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le08/ue08-01/">
<span class="md-ellipsis">
    UE08-01-INNER JOIN
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le08/ue08-02/">
<span class="md-ellipsis">
    UE08-02-LEFT-/RIGHT-JOIN
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le08/ue08-03/">
<span class="md-ellipsis">
    UE08-03-Unterabfragen
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le08/ue08-04/">
<span class="md-ellipsis">
    UE08-04-INSERT-SELECT
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le09/">
<span class="md-ellipsis">
    LE09-INDEX-Transaktion
  </span>
</a>
<label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_11">
<span class="md-nav__icon md-icon"></span>
            LE09-INDEX-Transaktion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le09/ue09-01/">
<span class="md-ellipsis">
    UE09-01-INDEX
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le09/index-perf-messung/">
<span class="md-ellipsis">
    INDEX-PERFORMANCE
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le09/ue09-02/">
<span class="md-ellipsis">
    UE09-02-Transaktion mit SQL
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le09/ue09-03/">
<span class="md-ellipsis">
    UE09-03-Transaktion mit Python
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le09/ue09-04/">
<span class="md-ellipsis">
    UE09-04-Chinook-Python-ERM
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le09/ue09-05/">
<span class="md-ellipsis">
    MySQL-Python: Verbindungsvarianten
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_12" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le10/">
<span class="md-ellipsis">
    LE10-ORM und Einstieg in PostgreSQL
  </span>
</a>
<label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_12_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_12">
<span class="md-nav__icon md-icon"></span>
            LE10-ORM und Einstieg in PostgreSQL
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/PeeWee_Example/">
<span class="md-ellipsis">
    PeeWee-Einführungsbeispiel
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/ue10-01/">
<span class="md-ellipsis">
    UE10-01 Aufgabe mit PeeWee Teil1
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/ue10-02/">
<span class="md-ellipsis">
    UE10-02 Aufgabe mit PeeWee Teil2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/ue10-03/">
<span class="md-ellipsis">
    UE10-03 eigenes ORM erstellen
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/postgresql-install/">
<span class="md-ellipsis">
    PostgreSQL installieren
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/python-postgresql/">
<span class="md-ellipsis">
    Python mit PostgreSQL verbinden
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le10/ue10-04/">
<span class="md-ellipsis">
    UE10-04 Mit PostgreSQL arbeiten
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_13" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le11/">
<span class="md-ellipsis">
    LE11-Timeseries Datenbanken
  </span>
</a>
<label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_13_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_13">
<span class="md-nav__icon md-icon"></span>
            LE11-Timeseries Datenbanken
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/tsdb-einfuehrung/">
<span class="md-ellipsis">
    Einführung TSDB und InfluxDB
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/inst-influxdb-docker/">
<span class="md-ellipsis">
    InfluxDB installieren
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/influxdb-einfuehrungsbeispiel/">
<span class="md-ellipsis">
    Einführungsbeispiel
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/ue11-01/">
<span class="md-ellipsis">
    UE11-01
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/ue11-02/">
<span class="md-ellipsis">
    UE11-02
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/ue11-03/">
<span class="md-ellipsis">
    UE11-03 Option
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le11/ue11-04/">
<span class="md-ellipsis">
    UE11-04 Integrierte Aufgabe
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_14" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    LE12-NoSQL Datenbanken
  </span>
</a>
<label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_14_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_14">
<span class="md-nav__icon md-icon"></span>
            LE12-NoSQL Datenbanken
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../install-3nodecassandraCluster/">
<span class="md-ellipsis">
    Installation Apache Cassandra als 3-Node-Cluster
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Tutorial
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Tutorial
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#eigenschaften-von-cassandra">
<span class="md-ellipsis">
      Eigenschaften von Cassandra
    </span>
</a>
<nav aria-label="Eigenschaften von Cassandra" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#cassandra-als-teil-der-applikationsentwicklung">
<span class="md-ellipsis">
      Cassandra als Teil der Applikationsentwicklung
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cassandra-und-das-cap-theorem">
<span class="md-ellipsis">
      Cassandra und das CAP-Theorem
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verteilte-skalierbare-nosql-datenbank">
<span class="md-ellipsis">
      Verteilte, skalierbare NoSQL-Datenbank
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#partitions">
<span class="md-ellipsis">
      Partitions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#praktische-vorbereitung">
<span class="md-ellipsis">
      Praktische Vorbereitung
    </span>
</a>
<nav aria-label="Praktische Vorbereitung" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#erstellen-von-keyspaces-und-cluster-replication">
<span class="md-ellipsis">
      Erstellen von Keyspaces und Cluster-Replication
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#eintauchen-und-hands-on-in-die-cassandra-architektur">
<span class="md-ellipsis">
      Eintauchen und Hands-On in die Cassandra Architektur
    </span>
</a>
<nav aria-label="Eintauchen und Hands-On in die Cassandra Architektur" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dezentralisation">
<span class="md-ellipsis">
      Dezentralisation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#jeder-node-ist-ein-coordinator">
<span class="md-ellipsis">
      Jeder Node ist ein Coordinator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-partitioning">
<span class="md-ellipsis">
      Data Partitioning
    </span>
</a>
<nav aria-label="Data Partitioning" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#bedeutung-des-partition-keys-zusammenfassung">
<span class="md-ellipsis">
      Bedeutung des Partition Keys - Zusammenfassung
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#replication">
<span class="md-ellipsis">
      Replication
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consistency-level">
<span class="md-ellipsis">
      Consistency Level
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tune-for-consistency-by-setting-up-a-strong-consistency-application">
<span class="md-ellipsis">
      Tune for Consistency by Setting up a Strong Consistency Application
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tune-for-performance-by-using-eventual-consistency">
<span class="md-ellipsis">
      Tune for Performance by Using Eventual Consistency
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#optimize-data-storage-for-reading-or-writing">
<span class="md-ellipsis">
      Optimize Data Storage for Reading or Writing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-compaction">
<span class="md-ellipsis">
      Understanding Compaction
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#presorting-data-on-cassandra-nodes">
<span class="md-ellipsis">
      Presorting Data on Cassandra Nodes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-modeling-fur-das-erstellen-einer-to-do-liste">
<span class="md-ellipsis">
      Data Modeling für das Erstellen einer To-Do-Liste
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#keep-data-in-sync-using-batch-statements">
<span class="md-ellipsis">
      Keep Data in Sync Using BATCH Statements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tombstones">
<span class="md-ellipsis">
      Tombstones
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updates-sind-inserts-und-inserts-sind-updates">
<span class="md-ellipsis">
      UPDATEs sind INSERTs und INSERTs sind UPDATEs !
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../NoSQL_Aufgabe/">
<span class="md-ellipsis">
    Aufgabe
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_15" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le13/">
<span class="md-ellipsis">
    LE13-Repetitionslektion
  </span>
</a>
<label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_15_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_15">
<span class="md-nav__icon md-icon"></span>
            LE13-Repetitionslektion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../le13/ue13-praxis/">
<span class="md-ellipsis">
    PRAKTISCHE AUFGABEN
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../le13/ue13-theorie/">
<span class="md-ellipsis">
    THEORETISCHE AUFGABEN
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_16" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../le14/">
<span class="md-ellipsis">
    LE14-Prüfungsvorbereitung
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_16_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_16">
<span class="md-nav__icon md-icon"></span>
            LE14-Prüfungsvorbereitung
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_17" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../schlusspruefung/">
<span class="md-ellipsis">
    Schlussprüfung
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_17_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_17">
<span class="md-nav__icon md-icon"></span>
            Schlussprüfung
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#eigenschaften-von-cassandra">
<span class="md-ellipsis">
      Eigenschaften von Cassandra
    </span>
</a>
<nav aria-label="Eigenschaften von Cassandra" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#cassandra-als-teil-der-applikationsentwicklung">
<span class="md-ellipsis">
      Cassandra als Teil der Applikationsentwicklung
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cassandra-und-das-cap-theorem">
<span class="md-ellipsis">
      Cassandra und das CAP-Theorem
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verteilte-skalierbare-nosql-datenbank">
<span class="md-ellipsis">
      Verteilte, skalierbare NoSQL-Datenbank
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#partitions">
<span class="md-ellipsis">
      Partitions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#praktische-vorbereitung">
<span class="md-ellipsis">
      Praktische Vorbereitung
    </span>
</a>
<nav aria-label="Praktische Vorbereitung" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#erstellen-von-keyspaces-und-cluster-replication">
<span class="md-ellipsis">
      Erstellen von Keyspaces und Cluster-Replication
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#eintauchen-und-hands-on-in-die-cassandra-architektur">
<span class="md-ellipsis">
      Eintauchen und Hands-On in die Cassandra Architektur
    </span>
</a>
<nav aria-label="Eintauchen und Hands-On in die Cassandra Architektur" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dezentralisation">
<span class="md-ellipsis">
      Dezentralisation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#jeder-node-ist-ein-coordinator">
<span class="md-ellipsis">
      Jeder Node ist ein Coordinator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-partitioning">
<span class="md-ellipsis">
      Data Partitioning
    </span>
</a>
<nav aria-label="Data Partitioning" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#bedeutung-des-partition-keys-zusammenfassung">
<span class="md-ellipsis">
      Bedeutung des Partition Keys - Zusammenfassung
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#replication">
<span class="md-ellipsis">
      Replication
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consistency-level">
<span class="md-ellipsis">
      Consistency Level
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tune-for-consistency-by-setting-up-a-strong-consistency-application">
<span class="md-ellipsis">
      Tune for Consistency by Setting up a Strong Consistency Application
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tune-for-performance-by-using-eventual-consistency">
<span class="md-ellipsis">
      Tune for Performance by Using Eventual Consistency
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#optimize-data-storage-for-reading-or-writing">
<span class="md-ellipsis">
      Optimize Data Storage for Reading or Writing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-compaction">
<span class="md-ellipsis">
      Understanding Compaction
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#presorting-data-on-cassandra-nodes">
<span class="md-ellipsis">
      Presorting Data on Cassandra Nodes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-modeling-fur-das-erstellen-einer-to-do-liste">
<span class="md-ellipsis">
      Data Modeling für das Erstellen einer To-Do-Liste
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#keep-data-in-sync-using-batch-statements">
<span class="md-ellipsis">
      Keep Data in Sync Using BATCH Statements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tombstones">
<span class="md-ellipsis">
      Tombstones
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updates-sind-inserts-und-inserts-sind-updates">
<span class="md-ellipsis">
      UPDATEs sind INSERTs und INSERTs sind UPDATEs !
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Tutorial</h1>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-29-46.png"><img alt="Image title" src="../../img/17-12-2024_20-29-46.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Zielsetzung des Tutorials</p>
<p>Erfahren Sie, wie eine <em>horizontal skalierbare Datenbank</em> funktioniert. Das gibt Ihnen einen Eindruck, wie Millionen von Endusern mit derselben Anwendung arbeiten können. Beispiele von Anwendungen grosser Firmen, die wir alle kennen: Netflix, Spotify, X, LinkedIn, Apple, Facebook, Instagramm, Uber, Pinterest, JPMorgan Chase, Visa, NetApp,.. </p>
<p>All diese Firmen setzen für Ihre global verteilten Anwendungen auch <strong><em>Apache Cassandra</em></strong> ein.</p>
<p>Weiter ist es eine gute Erfahrung, während der Ausbildung einmal mit <strong>NoSQL</strong> gearbeitet zu haben. Diese Datenbanken sind bei Anwendungen im Bereich von <em>BigData</em> omnipräsent. </p>
</div>
<h2 id="eigenschaften-von-cassandra">Eigenschaften von Cassandra</h2>
<p>Cassandra ist ein verteiltes Datenbank Management System, welches für die Verarbeitung grosser Datenvolumen geeignet ist.
Die Architektur ist auf mehrere Nodes (Rechner) verteilt. Die Daten werden unter den Nodes repliziert. Das führt zu einer hohen Verfügbarkeit ohne single point of failure, wenn &gt;= 3 Nodes eingesetzt werden.</p>
<p>Im unteren Bild entsprechen die Kreise einzelner Nodes. Die Verbindungen zwischen den Kreisen symbolisieren die verteilte Architektur. Der Client sendet seine Anfragen an einen Node in einem Cassandra-Cluster. Der Node, welcher die Anfrage annimmt, wird als Coodinator bezeichnet. Jeder Node innerhalb eines Cluster kann diese Rolle übernehmen.</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-33-05.png"><img alt="Image title" src="../../img/17-12-2024_20-33-05.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<h3 id="cassandra-als-teil-der-applikationsentwicklung">Cassandra als Teil der Applikationsentwicklung</h3>
<p>Im Relationalen Modell wird zuerst die Datenstruktur analysiert und dann am Ende die Applikation darauf angewendet. Die Applikation ruft Queries auf, um die benötigten Informationen aus dem Datenmodell zu holen.</p>
<p>Bei Apache Cassandra ist der Prozess umgekehrt. Hier wird zuerst die Anwendung entwickelt. Es wird entschieden, welche Queries in der Anwendung ausgeführt werden müssen. Dies führt zur Überlegung, wie das logische Datenmodell aussehen muss. Nachdem die Queries und das Datenmodell definiert sind, werden die Daten in Cassandra geladen.</p>
<p>Dieses Vorgehen, hier vereinfacht beschrieben,  ist nicht nur für Cassandra typisch, sondern für alle NoSQL-Datenbanken.</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-34-29.png"><img alt="Image title" src="../../img/17-12-2024_20-34-29.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<h3 id="cassandra-und-das-cap-theorem">Cassandra und das CAP-Theorem</h3>
<p>Im Zusammenhang mit dem CAP-Theorem präferiert Cassandra <strong>A</strong>vailability und <strong>P</strong>artition Tolearance und "opfert" die Konsistenz. Man spricht daher auch von einem <em>AP-System</em>. 
Die Consistency  kann jedoch mit der Anzahl eingesetzter Nodes in einem Cassandra-Setup "getuned" werden. Details dazu folgen. </p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-35-23.png"><img alt="Image title" src="../../img/17-12-2024_20-35-23.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<h3 id="verteilte-skalierbare-nosql-datenbank">Verteilte, skalierbare NoSQL-Datenbank</h3>
<p>Cassandra ist somit eine horizontal skalierbare, opensource NoSQL Datenbank.
Die Datenbank besteht aus mehreren Nodes, die logisch in einem Ring zusammengefasst sind. Die Nodes replizieren sich, so dass die DB stets konsistent ist. </p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-38-04.png"><img alt="Image title" src="../../img/17-12-2024_20-38-04.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<p>Die Skalierbarkeit kann damit erreicht werden, indem die Anzahl Nodes angepasst werden kann.
In der Dokumentation wird folgendes gesagt:</p>
<p><strong><em>„To double your capacity or double your throughput, double the number of nodes.“</em></strong></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-38-34.png"><img alt="Image title" src="../../img/17-12-2024_20-38-34.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<p>Die Message ist somit einfach: <strong>Je mehr Nodes, desto mehr Durchsatz.</strong></p>
<p>In diesem Zusammenhang bildet das Konzept der <em>Partitions</em> eine entscheidende Rolle.</p>
<h3 id="partitions">Partitions</h3>
<p>Daten können auf mehrere Nodes repliziert werden. Dies erhöht die Verfügbarkeit und Fehlertoleranz. In Cassandra exisitert der Begriff des <strong>Replication Factors RF</strong>. Dieser besagt, auf wie vielen Nodes die Daten repliziert werden sollen. Wenn unser Cassandra System aus einem Node besteht, ist der RF=1. Mit RF=2 werden die Daten auf einem weiteren Node repliziert, usw.</p>
<p>Der Betrieb von Cassandra macht Sinn, wenn das System aus mehrere Nodes besteht. Alle Nodes zusammen bilden einen <strong>Cluster</strong> oder "Ring".
<strong>Nodes sind untereinander gleichwertig</strong> und jeder Node hat dieselben Funktionalitäten wie alle andern. Man spricht hier auch von einer <em>masterless architecture</em>. </p>
<p>Jeder Node besitzt einen Satz von sogenannten <strong>Tokens</strong>. Diese Tokens spielen eine Rolle, wenn es darum geht, auf welchem Node innerhalb des Clusters die Daten abgespeichert werden sollen.  Dazu wird jeder verwaltbaren Datenzeile ein <strong>Partition Key</strong> zugeordnet. Dieser Key ist entscheidend für die Nodes, welche die Datenzeile abspeichern sollen. Wenn Daten in einem Cassandra Cluster eingefügt werden, wird als erster Schritt dieser Partition Key erstellt. Dieser Key <strong>bestimmt dann den Node, welcher für die Daten "verantwortlich" ist</strong>. Die Erstellung des Keys erfolgt durch das Generieren eines <strong>Hash-Wertes</strong>, welcher auf die Wertebereiche der Tokens abgestimmt ist, für welche die Nodes verantwortlich sind.
Für die Zuweisung des Nodes ist der <em>Database Coodinator</em> verantwortlich. Jeder Node in einem Cluster kann diese Rolle als Coodinator übernehmen. Alle Nodes kommunizieren mit dem sogenannten <strong><em>gossip</em>-Protokoll</strong>. Dieses Protokoll legt den aktuellen Coodinator fest. Das gossip-Protokoll legt auch fest, welcher Node für welche Token-Ranges verantwortlich ist. 
Wenn nun Daten im Cluster eingefügt werden, beispielsweise eine neue Zeile in einer Tabelle, bestimmt der aktuelle Coodinator die Partition Nummer, beispielsweise Nr. 59.
Der Coordinator schaut nun, welcher Node für Token Nr 59 verantwortlich ist und leitet die Daten an diesen weiter. Dieser Node wird auch <em>Replica Node</em> genannt. Wenn RF &gt; 1 ist, werden diese Daten an mehrere Nodes weitergeleitet. Bei RF=1 erhält nur ein Node die Daten.</p>
<p><strong>Beachte:</strong> 
Der <em>Coodinator Node</em> ist nicht auf einen Node beschränkt. Damit hätten wir einen <em>single point of failure</em>. Jeder Node kann diese Rolle übernehmen! Wer die Rolle zu einem bestimmten Zeitpunkt inne hat, wird durch das <em>gossip-Protokoll</em> bestimmt.</p>
<p><strong>Die Replikation in einem Cassandra-Datenbank-System garantiert Reliability und Fehlertoleranz.</strong></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-43-24.png"><img alt="Image title" src="../../img/17-12-2024_20-43-24.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Cassandra kennt weiter den Begriff des <em>Datacenter</em>. Cassandra repliziert die Daten zwischen den verschiedenen Datacenters. Dies hat vorallem Performance-Vorteile, wenn die Daten über mehrer Kontinente verteilt werden müssen.
Datacenter können bei der Konfiguration von Cassandra eingerichtet werden. Im Standard besteht das Cassandra-System aus einem Datacenter.
Es ist so auch nicht erstaunlich, dass die Erfinder von Cassandra ehemalige Facebook-Mitarbeiter waren. </p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-44-18.png"><img alt="Image title" src="../../img/17-12-2024_20-44-18.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Cassandra gilt als <strong>AP-System</strong> (Available Partition-tolerant) im Sinne des CAP-Theorems, welches Sie bereits kennen. Es "opfert" also das dritte Element in diesem Konzept, die Consistency. Diese Consistency kann jedoch parametriert werden, indem der <em>Consistency Level</em> <em>(CL)</em> in Cassandra eingestellt werden kann. Der CL besagt, wie viele Nodes im Cluster minimal ein Read/Write acknowledge dem Coordinator abgeben müssen, bevor die Operation als erfolgreich behandelt wird. Dieser <em>CL</em> basiert auf dem <em>Replication Factor RF</em>. Wenn RF=3 ist, müssen die Mehrheit der Nodes für eine Operation dem Coordinator ein <em>acknowledge</em> senden. In diesem Fall müssen das mindestens 2 Nodes machen. Wenn das nicht der Fall ist, wird die Operation vom Coodinator als nicht erfolgreich behandelt. Bei RF=6 ist der CL=(6/2+1)=4. Mindestens 4 Nodes müssen in diesem Fall ein acknowledge senden. Der <em>Consistency Level CL</em> wird auch als <em>Quorum</em> bezeichnet. </p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-45-22.png"><img alt="Image title" src="../../img/17-12-2024_20-45-22.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Diese Eigenschaft macht Cassandra sehr flexibel. Es spielt keine Rolle, wo sich die Nodes eines Cassandra-Clusters befinden - ob in einer Cloud oder in einem eigenen Rechencenter. Beliebige Infrastruktur-Kombinationen bilden eine einzige Datenbank, die global verfügbar sein kann.</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-45-58.png"><img alt="Image title" src="../../img/17-12-2024_20-45-58.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<h2 id="praktische-vorbereitung">Praktische Vorbereitung</h2>
<h3 id="erstellen-von-keyspaces-und-cluster-replication">Erstellen von Keyspaces und Cluster-Replication</h3>
<p>Wir werden in diesem Tutorial queries an Cassandra senden. Dazu verwenden wir die <strong>C</strong>assandra S<strong>QL</strong> - <strong>Sh</strong>ell. Diese heisst <code>cqlsh</code>. <code>cqlsh</code> wird in Docker wie folgt gestartet:</p>
<p><code>docker exec -it cassandra-1 cqlsh</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>vmadmin@cassandravm:~/scripts$ docker exec -it cassandra-1 cqlsh
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>Connected to my-cluster at 127.0.0.1:9042
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>[cqlsh 6.2.0 | Cassandra 5.0.2 | CQL spec 3.4.7 | Native protocol v5]
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>Use HELP for help.
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>cqlsh&gt;
</span></code></pre></div>
<p>Hier Ihr erstes Query:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>cqlsh&gt; DESCRIBE keyspaces;
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>system       system_distributed  system_traces  system_virtual_schema
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>system_auth  system_schema       system_views 
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>cqlsh&gt;
</span></code></pre></div>
<p>Als Antwort erhalten Sie alle existierenden <em>keyspaces</em>. Ein <em>Keyspace</em> enthält Tabellen und ist analog zu einem Datenbankschema in einer relationalen Datenbank. </p>
<p>Bevor wir Tabellen anlegen, müssen wir einen Keyspace erstellen. Wir erstellen diesen mit einem Replication Factor 3. Daten werden also auf allen 3 Nodes verwaltet:</p>
<p><code>cqlsh&gt;</code> Eingabe:</p>
<p><code>CREATE KEYSPACE M165 WITH replication = {'class':'SimpleStrategy', 'replication_factor' : 3};</code></p>
<p>Die Syntax wird <a href="https://www.tutorialspoint.com/cassandra/cassandra_create_keyspace.htm" target="_blank">hier</a> erklärt.</p>
<p>Damit wir ein Keyspace mit RF=3 erstellt. Die Strategie definiert, wie Daten in verschiedenen Datacenters repliziert werden soll. Vergleiche dazu das Kapitel zu den Partitions.</p>
<div class="admonition info">
<p class="admonition-title">Warum starten wir mit 3 Nodes?</p>
<ul>
<li>
<p>Es wird empfohlen, stets mit <strong>mindestens 3 Nodes</strong> ein Cassandra System zu betreiben.     </p>
</li>
<li>
<p>Wenn <strong>Consistency</strong> verlangt wird, benötigen wir ein <strong>Acknowlegement von mindestens 2 Nodes</strong>.    </p>
</li>
<li>
<p>Wenn ein Node ausfällt, ist der Cluster immer noch verfügbar, weil noch 2  Nodes vorhanden sind.    </p>
</li>
<li>
<p>Das Verständnis dazu wird im Verlaufe dieser Übungen entstehen.</p>
</li>
</ul>
<p>Unsere 3 Nodes sollten also hiermit <em>Up</em> <em>and Running</em> sein:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>vmadmin@cassandravm:~/scripts$ docker exec cassandra-3 nodetool status
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>Datacenter: datacenter1
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>=======================
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>Status=Up/Down
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>|/ State=Normal/Leaving/Joining/Moving
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>--  Address     Load        Tokens  Owns (effective)  Host ID                               Rack 
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>UN  172.17.0.4  192.62 KiB  16      64.7%             224bb3b4-3cec-45b6-89a7-0b231a237743  rack1
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>UN  172.17.0.3  211.35 KiB  16      59.3%             87693efc-73ec-45c6-a8eb-094071bb8942  rack1
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>UN  172.17.0.2  216.33 KiB  16      76.0%             c2e09e05-7ddb-4e90-a289-8cd0795e4d6e  rack1
</span></code></pre></div>
</div>
<p>Die Nodes hören auf den Ports <code>9042</code>, <code>9043</code> und <code>9044</code> auf Client-Requests. Den jeweils verwendeten Port sehen Sie beim Starten der cqlsh-Shell:
<code>docker exec -it cassandra-1 cqlsh</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>Connected to my-cluster at 127.0.0.1:9042
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>[cqlsh 6.2.0 | Cassandra 5.0.2 | CQL spec 3.4.7 | Native protocol v5]
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>Use HELP for help.
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>cqlsh&gt;
</span></code></pre></div>
<p>Dieses Szenario hier ist realistisch für einen kleinen Cluster. <strong>In einer produktiven Umgebung würden die Nodes auf eigenen Rechnern laufen</strong>, um die Performance zu erhöhen.</p>
<p>Bevor wir beginnen Tabellen zu erstellen, ist es nützlich einige <strong>Basics zum Tabellendesign</strong> zu verstehen.</p>
<h2 id="eintauchen-und-hands-on-in-die-cassandra-architektur">Eintauchen und Hands-On in die Cassandra Architektur</h2>
<p>Cassandra ist eine <em>dezentralisierte multi-node Datenbank</em>, welche <strong>physisch über mehrere Standorte</strong> verteilt ist. Sie verwendet <em>Replikation</em> und <em>Partitionen</em> und ist dadurch enorm <strong>skalierbar für Lese- und Schreiboperationen</strong>.</p>
<h3 id="dezentralisation">Dezentralisation</h3>
<p>Cassandra ist <strong>dezentral organisiert</strong>. Jeder Node ist gleichwertig; es sind Peers! Jeder Node agiert in verschiedenen Rollen und ohne zentralen Controller.</p>
<p>Die dezentrale Architektur von Cassandra erlaubt es, dass Nodes ausfallen können und auch nodes hinzugefügt werden, ohne dass das ganze System dadurch gestört wird.</p>
<h3 id="jeder-node-ist-ein-coordinator">Jeder Node ist ein Coordinator</h3>
<p>Daten werden auf verschiedene Nodes repliziert. Wenn ein Request anliegt, kann dieser von jedem Node verarbeitet werden.</p>
<p>Der <strong>initiale Request-Empfänger wird zu einem Coodinator Node</strong> für diesen Request. Wenn andere Nodes zwecks Konsistenzüberprüfung kontaktiert werden müssen, verlangt der Koordinator die benötigten Daten von den Replica Nodes.</p>
<p>Der Koordinator kann mit einem sogenannten  <a href="https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html?highlight=consistency#dataset-partitioning-consistent-hashing">Consistent Hashing Algorithmus</a> den Node oder die Nodes ermitteln, welche die Daten bereitstellen können. </p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_20-58-05.png"><img alt="Image title" src="../../img/17-12-2024_20-58-05.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Der Koordinator-Node ist für viele Dinge zuständig, z. Bsp. auch für das Reparieren von Daten oder für Read- und Write-Retries.</p>
<h3 id="data-partitioning">Data Partitioning</h3>
<div class="admonition info">
<p class="admonition-title">Partitioning </p>
<p>Partitioning is a method of splitting and storing a single logical dataset in multiple databases. By distributing the data among multiple machines, a cluster of database systems can store larger datasets and handle additional requests.</p>
</div>
<p>In Cassandra werden Daten in einem definierten Schema, dem sogenannten <em>Keyspace</em> verwaltet. Innerhalb dieses <em>Keyspace</em> werden die Tabellen angelegt.</p>
<p>Zusätzlich wird auch in Cassandra ein <em>Primary Key</em> für jede Tabelle definiert. Nur so ist eine eindeutige Identifizierung eines Datensatzes möglich.</p>
<p>Das Konzept der Primary Keys in Cassandra ist komplexer als in traditionellen relationalen Datenbanken, wie . Bsp, MySQL.</p>
<p><strong>In Cassandra beinhaltet ein Primary Key 2 Teile</strong>:
* einen obligatorischen  <strong>Partition Key</strong> und
* ein  optionales Set von  <strong>Clustering Columns</strong>.</p>
<p>Dazu mehr im Kapitel  "Data Modeling".</p>
<p>Im Folgenden widmen wir uns dem Partitioning.</p>
<p>Betrachten Sie folgende Tabelle:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>Table Users | Legend: p - Partition-Key, c - Clustering Column
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>country (p) | user_email (c)  | first_name | last_name | age
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>----------------------------------------------------------------
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>US          | john@email.com  | John       | Wick      | 55  
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>UK          | peter@email.com | Peter      | Clark     | 65  
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>UK          | bob@email.com   | Bob        | Sandler   | 23 
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>UK          | alice@email.com | Alice      | Brown     | 26
</span></code></pre></div>
<p>Die Spalten  <code>user_email</code> und <code>country</code> bilden zusammen den Primary Key.</p>
<p>Die  <code>country</code> - Spalte ist der <strong>Partition Key</strong> (p). Das <code>CREATE</code>-statement wollen wir nun erstellen:</p>
<p>Starten der Cassandra-SQL-Shell <code>cqlsh</code> und wechseln in den erstellten <code>m165</code>-Keyspace mit <code>use</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>vmadmin@cassandravm:~/scripts$ docker exec -it cassandra-1 cqlsh
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>Connected to Test Cluster at 127.0.0.1:9042
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>[cqlsh 6.1.0 | Cassandra 4.1.1 | CQL spec 3.4.6 | Native protocol v5]
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>Use HELP for help.
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>cqlsh&gt; DESCRIBE KEYSPACES;
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>m165    system_auth         system_schema  system_views         
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>system  system_distributed  system_traces  system_virtual_schema
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>cqlsh&gt; use M165;
</span></code></pre></div>
<p>Beachten Sie den <code>use</code>-Befehl. Damit wechseln wir in den erstellten Keyspace und müssen diesen dann nicht weiter angeben. Das Erstellen einer Tabelle <code>users_by_country</code> wird dann so gemacht:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>cqlsh&gt;
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>CREATE TABLE users_by_country (
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>    country text,
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    user_email text,
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>    first_name text,
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>    last_name text,
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>    age smallint,
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>    PRIMARY KEY ((country), user_email)
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>);
</span></code></pre></div>
<p>Pasten Sie den obigen CREATE-Befehl einfach in den <code>cqlsh</code>-Prompt. Es werden jeweils Punkte am Anfang der Zeile erscheinen, bis der Befehl mit <code>;</code> abgeschlossen ist. Das sieht dann so aus:</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-02-46.png"><img alt="Image title" src="../../img/17-12-2024_21-02-46.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Die erste Gruppe im <code>PRIMARY KEY</code> - Statement definiert den <strong>Partition Key</strong>. Alle weiteren Elemente bezeichnen die <strong>Clustering Spalten</strong>:</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-08-55.png"><img alt="Image title" src="../../img/17-12-2024_21-08-55.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Laden wir einige Daten in die Tabelle:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>cqlsh&gt; 
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>INSERT INTO users_by_country (country,user_email,first_name,last_name,age)
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>  VALUES('US', 'john@email.com', 'John','Wick',55);
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>INSERT INTO users_by_country (country,user_email,first_name,last_name,age)
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>  VALUES('UK', 'peter@email.com', 'Peter','Clark',65);
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>INSERT INTO users_by_country (country,user_email,first_name,last_name,age)
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>  VALUES('UK', 'bob@email.com', 'Bob','Sandler',23);
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>INSERT INTO users_by_country (country,user_email,first_name,last_name,age)
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>  VALUES('UK', 'alice@email.com', 'Alice','Brown',26);
</span></code></pre></div>
<p>Pasten Sie wiederum die INSERT-Statements in den <code>cqlsh</code>-Prompt und schliessen Sie die Eingabe mit <code>Enter</code> ab.</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-09-41.png"><img alt="Image title" src="../../img/17-12-2024_21-09-41.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Vielleicht stellen Sie sich hier die Frage, warum <code>country</code> als essentiellen Teil des Primary Keys verwendet wird? In einer relationalen DB hätten Sie das wohl nie gemacht.</p>
<p>Dies wird klar, nachdem Sie hier die Basics von Cassandra  durchgearbeitet haben.</p>
<p>Das <strong>Konzept des Partitioning</strong> ist die <strong>Grundlage für die enorme Skalierungsfähigkeit</strong> von Cassandra.
In diesem Beispiel basieren die Partitionen auf dem <code>country</code>. Alle Zeilen (Rows) mit <code>country</code>=US werden in ein und derselben Partition gehalten. Alle andern Zeilen mit <code>country</code>=UK werden in einer andern Partition verwaltet.</p>
<p>Neben dem Begriff <em>Partitioning</em> wird auch der Begriff <em>Shard</em> verwendet. Die Bedeutung ist dieselbe.</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-10-18.png"><img alt="Image title" src="../../img/17-12-2024_21-10-18.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Basierend auf dem Wert des Partition Keys werden Partitionen mit entsprechenden Daten gefüllt.
<strong>Diese Partition Keys sind also zuständig, welche Nodes welche Partitionen verwalten.</strong>
Das Verteilen der Daten auf mehrere Nodes ist die Basis der Skalierbarkeit von Cassandra.</p>
<p>Der User / die Anwendung liest oder schreibt die Daten, indem dazu <strong>mehrere Nodes</strong> involviert sind. Der Partition Key ist immer dafür verantwortlich, dass die richtigen Nodes angesprochen werden.</p>
<p>Das Verständnis der Datenverteilung, basierend auf Partitionen, ist sehr wichtig beim Design einer Applikation.</p>
<p><strong>Hier unterscheidet sich Cassandra sehr stark gegenüber den klassischen relationalen Datenbanken.</strong></p>
<div class="admonition info">
<p class="admonition-title">Was bedeutet horizontale Skalierung??</p>
<p>Horizontal scaling means you can increase throughput by adding more nodes. If your data is distributed to more servers, then more CPU, memory, and network capacity is available.</p>
</div>
<p>Warum braucht man dann <code>eMail</code> als Primary Key?</p>
<p>Der PK definiert die Spalte, um Records eindeutig zu identifizieren. Nur <code>country</code> würde eine Zeile nicht eindeutig identifizieren.</p>
<p>Der Partition Key ist wichtig, um Daten gleichmässig zwischen Nodes zu verteilen und wichtig, um die Daten effizient lesen zu können. Das definierte Schema wurde so festgelegt, dass die Daten meist pro Land abgefragt werden sollen, deshalb wurde <code>country</code> als Partition Key definiert:
<code>PRIMARY KEY ((country), user_email)</code></p>
<p>Eine Abfrage über alle Zeilen mit Selektion des Landes <em>performed</em> damit sehr gut: </p>
<p><code>cqlsh&gt; SELECT * FROM users_by_country WHERE country='US';</code></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-11-06.png"><img alt="Image title" src="../../img/17-12-2024_21-11-06.png" width="400"/></a>
<figcaption></figcaption>
</figure>
<p>Ihre <code>cqlsh</code>-shell sendet den Request nur an einen Casandra-Node - by default.
Dies bezeichnet man als <em>Consitency Level of One</em>.</p>
<div class="admonition info">
<p class="admonition-title">Was bedeutet eine  <em>Consitency Level of One</em>?</p>
<p>A consistency level of one means that only a single node is asked to return the data. With this approach, you will lose strong consistency guarantees and instead experience eventual consistency.
Eventual consistency erklären wir später.</p>
</div>
<p>Kreieren wir eine weitere Tabelle. Hier ist der Partition Key die E-Mail-Adresse:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>cqlsh&gt; 
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>CREATE TABLE users_by_email (
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>    user_email text,
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>    country text,
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>    first_name text,
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>    last_name text,
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>    age smallint,
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>    PRIMARY KEY (user_email)
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>);
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-11-49.png"><img alt="Image title" src="../../img/17-12-2024_21-11-49.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>... und noch einige Daten einfügen:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>cqlsh&gt; 
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>INSERT INTO users_by_email (user_email, country,first_name,last_name,age)
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>  VALUES('john@email.com', 'US', 'John','Wick',55);
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>INSERT INTO users_by_email (user_email,country,first_name,last_name,age)
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>  VALUES('peter@email.com', 'UK', 'Peter','Clark',65); 
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>INSERT INTO users_by_email (user_email,country,first_name,last_name,age)
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>  VALUES('bob@email.com', 'UK', 'Bob','Sandler',23);
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>INSERT INTO users_by_email (user_email,country,first_name,last_name,age)
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>  VALUES('alice@email.com', 'UK', 'Alice','Brown',26);
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-12-24.png"><img alt="Image title" src="../../img/17-12-2024_21-12-24.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Hier erhält jeder Record eine eigene Partition, weil jede E-Mail-Adresse einmalig ist. Dies wurde beim Kreieren der Tabelle so festgelegt:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>...
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>...
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>PRIMARY KEY (user_email));
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-13-00.png"><img alt="Image title" src="../../img/17-12-2024_21-13-00.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Wenn es darum geht, dass Records sehr schnell aufgrund der E-Mail-Adresse abgefragt werden sollen, ist das eine gute Idee, den Partition Key so zu definieren!
<code>SELECT * FROM users_by_email WHERE user_email='alice@email.com';</code></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-13-33.png"><img alt="Image title" src="../../img/17-12-2024_21-13-33.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Wenn die Daten mit dem Partition Key   <code>user_email</code>  eingefügt wurden und eine Abfrage nach <code>age</code> erfolgt, müssten die Daten über alle Partitionen "gesucht" werden!</p>
<p>Dies hätte Performance-Einbussen zur Folge. Insbesondere dann, wenn der Cluster aus sehr vielen Nodes besteht.</p>
<p>Cassandra versucht dies zu verhindern. Wenn eine Abfrage mit einem Spaltennamen erfolgt, welcher nicht ein Partition Key ist, muss Cassandra dies explizit mitgeteilt werden, indem das Keyword <code>ALLOW FILTERING</code> verwendet wird. Das geht so:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>cqlsh&gt; 
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>SELECT * FROM users_by_email WHERE age=26 ALLOW FILTERING;
</span></code></pre></div>
<p>Ohne  <code>ALLOW FILTERING</code> würde der Query <strong>nicht</strong> ausgeführt werden, bzw. eine Fehlermeldung wird dabei generiert. Dies soll verhindern, dass "expensive Queries", also Queries, welche eine hohe Last auf den Nodes erzeugen, abgesetzt werden.</p>
<p>Fehlermeldung, wenn <code>ALLOW FILTERING</code> nicht verwendet wird:</p>
<p><code>InvalidRequest: Error from server: code=2200 [Invalid query] message="Cannot execute this query as it might involve data filtering and thus may have unpredictable performance. If you want to execute this query despite the performance unpredictability, use ALLOW FILTERING"</code></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-14-14.png"><img alt="Image title" src="../../img/17-12-2024_21-14-14.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<h4 id="bedeutung-des-partition-keys-zusammenfassung">Bedeutung des Partition Keys - Zusammenfassung</h4>
<div class="admonition info">
<p class="admonition-title">Zusammenfassung - Bedeutung des Partition Keys</p>
<p>Der Partition Key spielt eine zentrale Rolle bei der Organisation und Verwaltung von Daten in Apache Cassandra. Hier sind einige wichtige Aspekte und Bedeutungen des Partition Keys:</p>
<ol>
<li><strong>Datenverteilung</strong>: Der Partition Key bestimmt, auf welchem Knoten im Cassandra-Cluster die Daten gespeichert werden. Dies geschieht durch einen <em>Hashing-Mechanismus</em>, der sicherstellt, dass Daten gleichmässig über alle Knoten verteilt werden. Dadurch wird eine optimale Lastverteilung und Skalierbarkeit erreicht.</li>
<li><strong>Performance und Abfrageoptimierung</strong>: Da der Partition Key verwendet wird, um Daten auf spezifischen Knoten zu speichern, können Abfragen, die den Partition Key verwenden, sehr effizient und schnell ausgeführt werden. Abfragen, die den Partition Key nicht enthalten, können jedoch langsamer sein, da sie alle Knoten im Cluster durchsuchen müssen.</li>
<li><strong>Datenlokalisierung</strong>: Daten, die denselben Partition Key teilen, werden auf demselben Knoten gespeichert. Dies erleichtert das Abrufen und die Verarbeitung zusammenhängender Daten. Zum Beispiel können alle Informationen zu einem spezifischen Benutzer unter einem einzigen Partition Key gespeichert werden, was schnelle und effiziente Abfragen ermöglicht.</li>
<li><strong>Replikation und Fehlertoleranz</strong>: Der Partition Key spielt auch eine Rolle bei der Replikation von Daten. Cassandra verwendet den Partition Key, um zu bestimmen, auf welchen Knoten Daten repliziert werden, basierend auf der Konfiguration des <em>Replikationsfaktors</em>. Dies erhöht die Fehlertoleranz und die Verfügbarkeit der Daten.</li>
<li><strong>Datenmodellierung</strong>: Bei der Gestaltung des Datenmodells in Cassandra ist die Wahl des Partition Keys von entscheidender Bedeutung. Ein gut gewählter Partition Key kann die Abfrageleistung erheblich verbessern und die Effizienz der Datenverteilung sicherstellen.</li>
</ol>
<p>Zusammengefasst ist der <em>Partition Key</em> ein <strong>kritischer Bestandteil von Cassandra</strong>, der die Datenverteilung, Abfrageleistung, Fehlertoleranz und die gesamte Effizienz des Systems beeinflusst.</p>
</div>
<h3 id="replication">Replication</h3>
<p>Skalierbarkeit mit nur Partitionierung ist limitiert! Dieses Element wird ergänzt mit dem <strong>Konzept der Replikation</strong>!</p>
<p>Betrachten Sie write requests, welche nur eine Partition betreffen. Alle requests würden an einen einzigen Node gesendet werden, welcher für diese Partition zuständig ist. Seine CPU, das Memory, der I/O-Durchsatz wären sehr belastet. Zusätzlich möchten Sie auch, dass der Request bearbeitet wird, wenn der Node nicht verfügbar ist.</p>
<p>Hier kommt das Konzept der Replikation zum Zug. Durch das Duplizieren der Daten auf mehrere Nodes, sog. <em>Replicas</em>, kann der Durchsatz erhöht werden, indem Nodes simultan Daten bereitstellen können. Auch erhöht dieses Konzept die Verfügbarkeit, weil ein Ausfall eines Nodes von andern Nodes abgefangen werden kann.</p>
<p>In Cassandra kann deshalb <strong>für jeden Keyspace ein Replication Factor (RF)</strong> definiert werden.
Unseren Keyspace <code>M165</code> haben wir mit eine RF von 3 festgelegt.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>cqlsh&gt; CREATE KEYSPACE M165
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>  WITH REPLICATION = { 
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>   'class' : 'NetworkTopologyStrategy',
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>   'datacenter1' : 3 
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>  };
</span></code></pre></div>
<p><strong>RF=1:</strong> Nur eine Kopie eines Records wird im Cluster gehalten. Wenn der Node mit dieser Kopie ausfällt, dass der Record nicht abgefragt werden.</p>
<p><strong>RF=2:</strong> Ein Record wird auf 2 verschiedenen Nodes gehalten. Jeder Node ist gleichgestellt. Es gibt keinen "Master"-Replica-Node. Ein Node kann auch ausfallen und die Abfrage wird trotzdem erfolgreich sein.</p>
<p>Als generelle Regel sollte der Replication Factor <strong>RF nie grösser als die Anzahl Nodes</strong> in einem Cluster sein. Man kann aber den Replication Factor zu Beginn höher einstellen und dann später die gewünschte Anzahl Nodes hinzufügen.</p>
<p>In produktiven Umgebungen ist ein <strong>RF von 3 empfohlen</strong>. Dies gewährt Sicherheit, dass es sehr unwahrscheinlich wird, dass Daten verloren gehen oder kein Zugriff darauf erfolgen kann.</p>
<p>Auch im Fall von inkonsistenten Daten (die Replicas haben unterschiedliche Daten), können die einzelnen Nodes nach dem Daten-Status abgefragt werden. Es kann dann entschieden werden, ob der Status der Mehrheit der Nodes der gültige sein soll.</p>
<p>In unserem Cassandra Setup besteht der Cluster aus 3 Nodes mit 3 Replicas. Die Mehrheit der Nodes ist somit 2. Dies erlaubt uns, einige Überlegungen zum Konsistenz-Level im nächsten Kapitel anzustellen.</p>
<h3 id="consistency-level">Consistency Level</h3>
<p>Nach dem <strong>Partitioning</strong> und der <strong>Replikation</strong> nehmen wir uns dem Thema der <strong>Datenkonsistenz</strong> an.
Cassandra hat in diesem Bereich viel zu bieten. Der Begriff hier ist: <strong>Tunable Consistency</strong>.</p>
<p>Das Konsistenz-Level für Read/Write-Queries kann eingestellt werden. Settings dazu sind <a href="https://docs.datastax.com/en/cassandra-oss/3.x/cassandra/dml/dmlConfigConsistency.html">hier</a> ausführlich dokumentiert.</p>
<p>Schauen wir uns das bekannteste Setting zuerst an.
Nehmen wir an, wir haben 3 Replicas definiert. </p>
<p>Erste Frage: 
Haben wir einen Bedarf an hoher Datenkonsistenz?</p>
<div class="admonition info">
<p class="admonition-title">Was bedeutet Strong Consistency?</p>
<p>In contrast to eventual consistency, strong consistency means only one state of your data can be observed at any time in any location.</p>
<p>For example, when consistency is critical, like in a banking domain, you want to be sure that everything is correct. You would rather accept a decrease in availability and increase of latency to ensure correctness.</p>
</div>
<p>Hier spielt das  <a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP Theorem</a> eine wichtige Rolle. Es ist unmöglich in einem bestimmten Zeitpunkt gleichzeitig <strong>Verfügbarkeit UND Konsistenz</strong> zu garantieren, wenn Verbindungs- oder andere technische Probleme in einem Cluster auftauchen.</p>
<p>Beispiel:
Sie schreiben einen einzelnen Wert in eine Tabelle. Die Daten werden auf 2 Nodes repliziert.
Jetzt entsteht zwischen den Nodes ein Unterbruch.
Zuerst wird der Write-Request an Node 1 gesendet. Dann werden Daten von Node 2 gelesen.</p>
<p>Wie verhalten wir uns in dieser Situation?</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-20-08.png"><img alt="Image title" src="../../img/17-12-2024_21-20-08.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<ol>
<li>Soll das Schreiben verhindert werden, weil Node 2 nicht erreichbar ist? Dies würde bedeuten, dass wir die Verfügbarkeit opfern zugunsten der Datenkonsistenz.</li>
<li>Akzeptiren wir den Schreibzugriff auf Node 1 und lassen wir Lesezugriffe von Node 1 und 2 zu? Das System wäre mit diesem Entscheid weiterhin verfügbar. Wir riskieren jedoch, dass Daten nicht auf jedem Replication Node identisch ist, weil ja hier in unserem Beispiel Node 1 mit Node 2 nicht replizieren kann. In diesem Fall opfern wir Datenkonsistenz zugunsten der Verfügbarkeit.</li>
</ol>
<p><strong>Die entscheidende Frage ist: Wollen wir Verfügbarkeit oder Datenkonsistenz?</strong></p>
<p>Ein anderer Faktor ist folgender: 
Das Garantieren von Konsistenz bedingt, dass wir mehrere Nodes anfragen müssen. Dies versursacht eine "Wartezeit", um alle Antworten der Nodes auswerten zu können. Wollen wir diese Wartezeit (Latency) zugunsten der Konsistenz akzeptieren?</p>
<h3 id="tune-for-consistency-by-setting-up-a-strong-consistency-application">Tune for Consistency by Setting up a Strong Consistency Application</h3>
<p>Es gibt eine wichtige Formel, welche eine hohe Dastenkonsistenz garantiert: </p>
<p><code>[read-consistency-level] + [write-consistency-level] &gt; [replication-factor]</code></p>
<div class="admonition info">
<p class="admonition-title">Was heisst Konsistenz Level?</p>
<p>Consistency level means <strong><em>how many nodes</em></strong> need to acknowledge a read or a write query.</p>
</div>
<p>Das Read- und Write-Konsistez-Level können damit festgelegt werden.
Das Konsistenzlevel kann aber auch zugunsten der Perfomance reduziert werden:</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-21-39.png"><img alt="Image title" src="../../img/17-12-2024_21-21-39.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<p>Für <strong>read-intensive Anwendungen</strong>, wird empfohlen die Read-Konsistenz tief zu halten, weil Read-IOs häufiger sind als Write-IOs.
Nehmen wir an, wir haben einen Replication Factor von 3. 
Die Formel würde dann lauten:
<code>1 + [write-consistency-level] &gt; 3</code></p>
<p>Die write-Konsistenz wäre in diesem Fall 3, um ein stark konsistentes System zu betreiben.</p>
<p>Für  <strong>write-intensive Anwendungen</strong> wäre gemäss Formel das write-consistence-level = 1 und somit das read-consistence-level = 3.</p>
<p>Entweder wird bei einem Read jeder Node überprüft, ob jeder Node den gleichen Datenstatus hat - oder - bei einem Write wird überprüft, dass alle Nodes die Daten in ihrem lokalen Storage geschrieben haben.
Diese Checks garantieren, dass Daten zum Lesen und Schreiben korrekt sind.</p>
<p>In unserem Beispiel haben wir einen RF von 3.
Wir können so den Konsistenz Level maximal definieren mit  <code>ALL</code> oder <code>THREE</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>cqlsh&gt; 
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>   CONSISTENCY ALL;
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>   SELECT * FROM users_by_country WHERE country='US';
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-22-29.png"><img alt="Image title" src="../../img/17-12-2024_21-22-29.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<h3 id="tune-for-performance-by-using-eventual-consistency">Tune for Performance by Using Eventual Consistency</h3>
<p>Um Performance zu gewinnen, kann der Konsistenz-Level für Queries reduziert werden, z. Bsp auf 1:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>cqlsh&gt; 
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>   CONSISTENCY ONE;
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>   SELECT * FROM users_by_country WHERE country='US';
</span></code></pre></div>
<p>Damit gewinnt man Performance, steht aber im Risiko mit der Datenkonsistenz, welche durch viele Faktoren beieinträchtigt werden kann.</p>
<p>Cassandra hat in diesem Bereich viele Einstellungsmöglichkeiten, wie Inkonsistenzen behandelt werden sollen.</p>
<h3 id="optimize-data-storage-for-reading-or-writing">Optimize Data Storage for Reading or Writing</h3>
<p>Writes are cheaper than reads in Cassandra due to its storage engine. Writing data means simply appending something to a so-called commit-log.</p>
<p>Commit-logs are append-only logs of all mutations local to a Cassandra node and reduce the required I/O to a minimum.</p>
<p>Reading is more expensive, because it might require checking different disk locations until all the query data is eventually found. </p>
<p>But this does not mean Cassandra is terrible at reading. Instead, Cassandra's storage engine can be tuned for reading performance or writing performance.</p>
<h3 id="understanding-compaction">Understanding Compaction</h3>
<p>For every write operation, data is written to disk to provide durability. This means that if something goes wrong, like a power outage, data is not lost.</p>
<p>The foundation for storing data are the so-called  <a href="https://docs.datastax.com/en/archived/cassandra/3.0/cassandra/dml/dmlHowDataWritten.html">SSTables</a> . SSTables are immutable data files Cassandra uses to persist data on disk.</p>
<p>You can set various strategies for a table that define how data should be merged and compacted. These strategies affect read and write performance:</p>
<ul>
<li><code>SizeTieredCompactionStrategy</code> is the default, and is especially performant if you have more writes than reads,</li>
<li><code>LeveledCompactionStrategy</code> optimizes for reads over writes. This optimization can be costly and needs to be tried out in production carefully</li>
<li><code>TimeWindowCompactionStrategy</code> is for Time-series data</li>
</ul>
<p>By default, tables use the <code>SizeTieredCompactionStrategy</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>cqlsh&gt; 
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>   DESCRIBE TABLE users_by_country;
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-23-16.png"><img alt="Image title" src="../../img/17-12-2024_21-23-16.png" width="800"/></a>
<figcaption></figcaption>
</figure>
<p>Although you can alter the compaction strategy of an existing table, I would not suggest doing so, because all Cassandra nodes start this migration simultaneously. This will lead to significant performance issues in a production system.</p>
<p>Instead, define the compaction strategy explicitly during table creation of your new table:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>cqlsh&gt; 
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>CREATE TABLE users_by_country_with_leveled_compaction (
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a>    country text,
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a>    user_email text,
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>    first_name text,
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>    last_name text,
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>    age smallint,
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>    PRIMARY KEY ((country), user_email)
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>) WITH
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>  compaction = { 'class' :  'LeveledCompactionStrategy'  };
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-24-04.png"><img alt="Image title" src="../../img/17-12-2024_21-24-04.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Let’s check the result:</p>
<p><code>DESCRIBE TABLE users_by_country_with_leveled_compaction;</code></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-24-44.png"><img alt="Image title" src="../../img/17-12-2024_21-24-44.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>The strategies define when and how compaction is executed. Compaction means rearranging data on disk to remove old data and keep performance as good as possible when more data needs to be stored.</p>
<p>Check out the excellent <a href="https://docs.datastax.com/en/dse/5.1/dse-arch/datastax_enterprise/dbInternals/dbIntHowDataMaintain.html#dbIntHowDataMaintain__dml_types_of_compaction">DataStax documentation about compaction</a>   for details. There may even be better strategies in the future for the performance of your use-case.</p>
<h3 id="presorting-data-on-cassandra-nodes">Presorting Data on Cassandra Nodes</h3>
<p>A table always requires a primary key. A primary key consists of 2 parts:</p>
<ul>
<li>At least 1 column(s) as partition key and</li>
<li>Zero or more clustering columns for nesting rows of the data.</li>
</ul>
<p>All columns of the partition key together are used to identify partitions. All primary key columns, meaning partition key and clustering columns, identify a specific row within a partition.</p>
<p>In Cassandra, data is already sorted on disk. So if you want to avoid sorting data later, you can make sure sorting is applied as needed. This can be ensured on the table level and avoids having to sort data in the client applications that query Cassandra.</p>
<p>In our <code>users_by_country</code> table, you can define <code>age</code> as another clustering column to sort stored data:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>cqlsh&gt; 
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>CREATE TABLE users_by_country_sorted_by_age_asc (
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>    country text,
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>    user_email text,
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>    first_name text,
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>    last_name text,
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>    age smallint,
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>    PRIMARY KEY ((country), age, user_email)
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>) WITH CLUSTERING ORDER BY (age ASC);
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-25-31.png"><img alt="Image title" src="../../img/17-12-2024_21-25-31.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Let’s add the same data again:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>cqlsh&gt; 
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>INSERT INTO users_by_country_sorted_by_age_asc (country,user_email,first_name,last_name,age)
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>  VALUES('US','john@email.com', 'John','Wick',10);
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>INSERT INTO users_by_country_sorted_by_age_asc (country,user_email,first_name,last_name,age)
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>  VALUES('UK', 'peter@email.com', 'Peter','Clark',30);
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>INSERT INTO users_by_country_sorted_by_age_asc (country,user_email,first_name,last_name,age)
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>  VALUES('UK', 'bob@email.com', 'Bob','Sandler',20);
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>INSERT INTO users_by_country_sorted_by_age_asc (country,user_email,first_name,last_name,age)
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a>  VALUES('UK', 'alice@email.com', 'Alice','Brown',40);
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-26-19.png"><img alt="Image title" src="../../img/17-12-2024_21-26-19.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>And get the data by country:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>cqlsh&gt; 
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>      SELECT * FROM users_by_country_sorted_by_age_asc WHERE country='UK';
</span></code></pre></div>
<p>In this example, the clustering columns are <code>age</code> and <code>user_email</code>. So the data is first sorted by <code>age</code> and then by <code>user_email</code>. At its core, Cassandra is still like a key-value store. Therefore, you can only query the table by:</p>
<ul>
<li><code>country</code></li>
<li><code>country</code> and <code>age</code></li>
<li><code>country</code>, <code>age</code>, and <code>user_email</code></li>
</ul>
<p>But never by <code>country</code> and <code>user_email</code>.</p>
<p>After learning about partitioning, replication and consistency levels, let's head into data modeling and have more fun with the Cassandra cluster.</p>
<h3 id="data-modeling-fur-das-erstellen-einer-to-do-liste">Data Modeling für das Erstellen einer To-Do-Liste</h3>
<p>You've already learned a lot about the fundamentals of Cassandra.</p>
<p>Let's put your knowledge into practice and design a <strong>to-do list application</strong> that receives many more reads than writes.</p>
<p>The best approach is to analyze some user stories you want to fulfill with your table design:</p>
<ol>
<li>As a user, I want to create a to-do element </li>
</ol>
<p><strong>Note:</strong> 
This is only about creating data. For now, you can delay some decisions because you want to focus on how data is read.</p>
<ol>
<li>As a user, I want to list all my to-do elements in ascending order</li>
</ol>
<p>First, you need to query by <code>user_email</code>. Create a table called <code>todos_by_user_email</code>.</p>
<p>You need 1 table that contains all the information of a to-do element of a user. Data should be partitioned by <code>user_email</code> for efficient read and writes by <code>user_email</code>.</p>
<p>Also, the oldest records should be displayed first, which means using the creation date as a clustering column. The <code>creation_date</code> also ensures uniqueness.:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>cqlsh&gt; 
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>CREATE TABLE todo_by_user_email (
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>    user_email text,
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a>    name text,
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>    creation_date timestamp,
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>    PRIMARY KEY ((user_email), creation_date)
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a>) WITH CLUSTERING ORDER BY (creation_date DESC)
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a>AND compaction = { 'class' :  'LeveledCompactionStrategy'  };
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-27-18.png"><img alt="Image title" src="../../img/17-12-2024_21-27-18.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<ol>
<li>As a user, I want to share a to-do element with another user</li>
</ol>
<p>To get all the to-dos shared with a user, you need to create a table called <code>todos_shared_by_target_user_email</code> to display all shared to-dos for the target user. </p>
<p>The table contains the to-do name to display it.</p>
<p>But the user also wants to see the to-dos they shared with other users. This is another table, <code>todos_shared_by_source_user_email</code>.</p>
<p>Both tables have, according to the use-case, the required <code>user_email</code> as partition keys to allow efficient queries. Also, <code>creation_date</code> is added as a clustering column for sorting and uniqueness:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>cqlsh&gt; 
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>CREATE TABLE todos_shared_by_target_user_email (
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a>    target_user_email text,
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a>    source_user_email text,
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>    creation_date timestamp,
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a>    name text,
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a>    PRIMARY KEY ((target_user_email), creation_date)
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a>) WITH CLUSTERING ORDER BY (creation_date DESC)
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a>AND compaction = { 'class' :  'LeveledCompactionStrategy'  };
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>CREATE TABLE todos_shared_by_source_user_email (
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a>    target_user_email text,
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a>    source_user_email text,
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a>    creation_date timestamp,
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a>    name text,
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a>    PRIMARY KEY ((source_user_email), creation_date)
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a>) WITH CLUSTERING ORDER BY (creation_date DESC)
</span><span id="__span-21-18"><a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a>AND compaction = { 'class' :  'LeveledCompactionStrategy'  };
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-28-04.png"><img alt="Image title" src="../../img/17-12-2024_21-28-04.png" width="400"/></a>
<figcaption></figcaption>
</figure>
<p>This type of modeling is different than thinking about foreign keys and primary keys that you might know from traditional databases. In the beginning, it's all about defining tables and thinking about what values you want to filter and need to display.</p>
<p>You need to set a partition key to ensure the data is organised for efficient read and write operations. Also, you need to set clustering columns to ensure uniqueness, sort order, and optional query parameters.</p>
<h3 id="keep-data-in-sync-using-batch-statements">Keep Data in Sync Using <code>BATCH</code> Statements</h3>
<p>Due to the duplication, you need to take care to <strong>keep data consistent</strong>. In Cassandra, you can do that by using <code>BATCH</code> statements that give you an all-at-once guarantee, also called <em>atomicity</em>.</p>
<p>This might sound like a lot of work, and yes, it is a lot of work! If you have a table schema with many relationships, you will have more work compared to a normalized table schema.</p>
<div class="admonition info">
<p class="admonition-title">What is a normalized table schema?</p>
<p>A normalized table schema is optimized to contain no duplications. Instead, data is referenced by ID and needs to be joined later. In Cassandra, you <strong>try to avoid normalized tables</strong>. <strong>It is not even possible to write a query that contains a join</strong>.</p>
</div>
<p>Batch statements are cheap on a single partition, but dangerous when you execute them on different partitions, because:</p>
<ul>
<li>Data mutations will not be applied at the same time to all partitions, with no isolation</li>
<li>It is expensive for the coordinator node, because you have to talk to multiple nodes and prepare for a rollback if something goes wrong</li>
<li>There is a batch query size limit of 50kb to avoid overloading the coordinator. This limit can be increased, but this is not recommended</li>
</ul>
<p>In general, batches are costly.</p>
<p>There are other ways to apply changes eventually. If you need to execute them very often, consider using <em>async queries</em> instead with a proper retry mechanism. </p>
<p>Depending on the way you access your Cassandra, the driver might already offer you retry capabilities.</p>
<p>Still, this approach requires thinking about what will happen if a query is never executed. If every query really needs to be executed eventually, how can you make sure that it does not get lost if your service goes down?</p>
<p>The key learning here is: </p>
<ul>
<li>Single partition batches are cheap and should be used</li>
<li>Batches that include different partitions are expensive, and if there are a lot of reads/writes, this might be the reason why a Cassandra cluster is exhausted.</li>
</ul>
<p>Let’s create a <code>BATCH</code> statement that contains a to-do element that is shared with a user:</p>
<p>cqlsh&gt; </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>BEGIN BATCH
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>  INSERT INTO todo_by_user_email (user_email,creation_date,name) VALUES('alice@email.com', toTimestamp(now()), 'My first todo entry')
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>  INSERT INTO todos_shared_by_target_user_email (target_user_email, source_user_email,creation_date,name) VALUES('bob@email.com', 'alice@email.com',toTimestamp(now()), 'My first todo entry')
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a>  INSERT INTO todos_shared_by_source_user_email (target_user_email, source_user_email,creation_date,name) VALUES('alice@email.com', 'bob@email.com', toTimestamp(now()), 'My first todo entry')
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>APPLY BATCH;
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-28-56.png"><img alt="Image title" src="../../img/17-12-2024_21-28-56.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Let’s look into one of the tables:</p>
<p><code>SELECT * FROM todos_shared_by_target_user_email WHERE target_user_email='bob@email.com';</code></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-29-36.png"><img alt="Image title" src="../../img/17-12-2024_21-29-36.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>All the data exists and can be accessed in a performant way using all the defined tables.</p>
<h3 id="tombstones">Tombstones</h3>
<p>Cassandra is a multi-node cluster that contains <strong>replicated data on different nodes</strong>. <strong>Therefore, a delete can not simply delete a particular record</strong>.</p>
<p>For a delete operation, a new entry is added to the commit-log like for any other insert and update mutation. These deletes are called <em>tombstones</em>, and they <strong>flag a specific value for deletion.</strong></p>
<p>Tombstones exist only on disk and can be analyzed and traced as described in this blog post: <a href="https://thelastpickle.com/blog/2016/07/27/about-deletes-and-tombstones.html">About Deletes and Tombstones in Cassandra.</a></p>
<p>In Cassandra, you can set a time to live on inserted data. After the time passed, the record will be automatically deleted. When you set a time to live (<code>TTL</code>), a tombstone is created with a date in the future.</p>
<p>In comparison, a regular delete query is the same with the difference that the time date of the tombstone is set to the moment the delete is executed.</p>
<p>Let’s create a tombstone by setting a <code>TTL</code> in seconds which basically function as a <strong>delayed delete</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>cqlsh&gt;     
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>INSERT INTO todo_by_user_email (user_email,creation_date,name) VALUES('john@email.com', toTimestamp(now()), 'This entry should be removed soon') USING TTL 60;
</span></code></pre></div>
<p>Prüfe mit:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>SELECT * FROM todo_by_user_email WHERE user_email='john@email.com';
</span></code></pre></div>
Nach 60 Sekunden sollte der Record nicht mehr vorhanden sein:
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-30-17.png"><img alt="Image title" src="../../img/17-12-2024_21-30-17.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>Setting a TTL is one of many ways to  create and execute tombstones.</p>
<p>Unfortunately, there are also others.</p>
<p>For example, when you insert a null value, a tombstone is created for the given cell. And as mentioned for delete requests, different types of tombstones are stored. </p>
<p>By default, after 10 days, data that is marked by a tombstone is freed with a <em>compaction execution</em>. This time can be configured and reduced using the <code>gc_grace_seconds</code> option in the Cassandra configuration.</p>
<div class="admonition info">
<p class="admonition-title">When is a compaction executed?</p>
<p>When the operation is executed depends mainly on the selected strategy. In general, a compaction execution takes SSTables and creates new SSTables out of it.
The most common executions are:    </p>
<ul>
<li>When conditions for a compaction are true, that triggers compaction execution when data is inserted</li>
<li>A manually executed major compaction using the <code>nodetool</code></li>
</ul>
</div>
<p>Sometimes, tombstones are not deleted for the following reasons:</p>
<ul>
<li><strong>Null values mark</strong> values to be deleted and are stored as tombstones. This can be avoided by either replacing null with a static value, or not setting the value at all if the value is null</li>
<li><strong>Empty lists and sets</strong> are similar to null for Cassandra and create a tombstone, so don’t insert them if they’re empty. Take care to avoid null pointer exceptions when storing and retrieving data in your application</li>
<li><strong>Updated lists and sets</strong> create tombstones. If you update an entity and the list or set does not change, it still creates a tombstone to empty the list and set the same values. Therefore, only update necessary fields to avoid issues. The good thing is, they are compacted due to the new values</li>
</ul>
<p>If you have many tombstones, you might run into another Cassandra issue that prevents a query from being executed.</p>
<p>This happens when the <code>tombstone_failure_threshold</code> is reached, which is set by default to 100,000 tombstones. This means that, when a query has iterated over more than 100,000 tombstones, it will be aborted.</p>
<p>The issue here is, once a query stops executing, it’s not easy to tidy things up because Cassandra will stop even when you execute a delete, as it has reached the tombstone limit.</p>
<p>Usually you would never have that many tombstones. But mistakes happen, and you should take care to avoid this case.</p>
<h3 id="updates-sind-inserts-und-inserts-sind-updates">UPDATEs sind INSERTs und INSERTs sind UPDATEs !</h3>
<p>In Cassandra, <strong>everything is append-only</strong>. There is <strong>no difference between an update and insert</strong>.</p>
<p>You already learned that a primary key defines the uniqueness of a row. If there is no entry yet, a new row will appear, and if there is already an entry, the entry will be updated. It does not matter if you execute an update or insert a query.</p>
<p>The primary key in our example is set to <code>user_email</code> and <code>creation_date</code> that defines record uniqueness.</p>
<p>Let’s insert a new record:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a>cqlsh&gt;      
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>INSERT INTO todo_by_user_email (user_email, creation_date, name) VALUES('john@email.com', '2021-03-14 16:07:19.622+0000', 'Insert query');
</span></code></pre></div>
<p>And execute an update with a new <code>todo_uuid</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>cqlsh&gt;    
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>UPDATE todo_by_user_email SET 
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>    name = 'Update query'
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a>  WHERE user_email = 'john@email.com' AND creation_date = '2021-03-14 16:10:19.622+0000';
</span></code></pre></div>
<p>2 new rows appear in our table:</p>
<p><code>SELECT * FROM todo_by_user_email WHERE user_email='john@email.com';</code></p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-31-07.png"><img alt="Image title" src="../../img/17-12-2024_21-31-07.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>So you inserted a row using an update, and you can also use an insert to update:</p>
<p><code>INSERT INTO todo_by_user_email (user_email,creation_date,name) VALUES('john@email.com', '2021-03-14 16:07:19.622+0000', 'Insert query updated');</code></p>
<p>Let’s check our updated row:
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a>SELECT * FROM todo_by_user_email WHERE user_email='john@email.com';
</span></code></pre></div>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../../img/17-12-2024_21-31-40.png"><img alt="Image title" src="../../img/17-12-2024_21-31-40.png" width="600"/></a>
<figcaption></figcaption>
</figure>
<p>So <code>UPDATE</code> and <code>INSERT</code> are technically the same. Don’t think that an <code>INSERT</code> fails if there is already a row with the same primary key.</p>
<p>The same applies to an <code>UPDATE</code> — it will be executed, even if the row doesn’t exist.</p>
<p><strong>The reason for this is because, by design, Cassandra rarely reads before writing to keep performance high.</strong></p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Installation Apache Cassandra als 3-Node-Cluster" class="md-footer__link md-footer__link--prev" href="../install-3nodecassandraCluster/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Installation Apache Cassandra als 3-Node-Cluster
              </div>
</div>
</a>
<a aria-label="Next: Aufgabe" class="md-footer__link md-footer__link--next" href="../NoSQL_Aufgabe/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Aufgabe
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      2024 © Thomas Jäggi, Berne University of Applied Sciences - Berner Fachhochschule - BFH
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/thomas-j%C3%A4ggi-026350141/" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.06 2.06 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065m1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.indexes", "navigation.top", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
<script src="../../javascripts/katex.js"></script>
<script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
<script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>